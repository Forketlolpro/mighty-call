<form [formGroup]="form">
  <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ title: 'Name', control: form.get('firstName') }"></ng-container>
  <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ title: 'Last name', control: form.get('lastName') }"></ng-container>
  <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ title: 'Phone', control: form.get('phone') }"></ng-container>
  <ng-container [ngTemplateOutlet]="formField" [ngTemplateOutletContext]="{ title: 'Link', control: form.get('link'), deletable: true }"></ng-container>

  <div formArrayName="customFields">
    <div *ngFor="let group of customFields.controls; let i=index">
      <div [formGroupName]="i">
        <ng-container
            [ngTemplateOutlet]="formField"
            [ngTemplateOutletContext]="{ title: getFieldName(group.value), control: group.get(getFieldName(group.value)), deletable: true }">
        </ng-container>
      </div>
    </div>
  </div>
</form>

<app-field-creator [(contactForm)]="form"></app-field-creator>

<div>
  <button class="main-button" mat-raised-button color="primary" (click)="saveContact()">
    <mat-icon class="main-button-icon">add_circle_outline</mat-icon>Save contact
  </button>
  <button mat-raised-button color="primary" [routerLink]="['..']">Cancel</button>
</div>

<ng-template #formField let-title="title" let-control="control" let-deletable="deletable">
  <mat-form-field *ngIf="control">
    <mat-label>{{ title }}</mat-label>
    <input
        matInput
        type="text"
        [formControl]="control">
    <button
        *ngIf="control.value"
        mat-button
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="control.setValue('')">
      <mat-icon>close</mat-icon>
    </button>
    <button
        *ngIf="deletable"
        class="delete-field-button"
        mat-icon-button
        (click)="deleteField(control)">
      <mat-icon>highlight_off</mat-icon>
    </button>
  </mat-form-field>
</ng-template>

